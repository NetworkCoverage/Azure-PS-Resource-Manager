{
    "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
        "firewallPolicies_avd_fw_policy_uswest_premium_1067c5_name": {
            "defaultValue": "avd-fw-policy-uswest_premium_1067c5",
            "type": "String"
        },
        "workspaces_shared_fwpolicy_analytics_workspace_uswest_externalid": {
            "defaultValue": "/subscriptions/f0671b50-8e13-4496-b61f-7e4c79db3c90/resourceGroups/sobpoc-shared-uswest/providers/Microsoft.OperationalInsights/workspaces/shared-fwpolicy-analytics-workspace-uswest",
            "type": "String"
        }
    },
    "variables": {},
    "resources": [
        {
            "type": "Microsoft.Network/firewallPolicies",
            "apiVersion": "2023-05-01",
            "name": "[parameters('firewallPolicies_avd_fw_policy_uswest_premium_1067c5_name')]",
            "location": "West US",
            "properties": {
                "sku": {
                    "tier": "Premium"
                },
                "threatIntelMode": "Alert",
                "dnsSettings": {
                    "servers": [],
                    "enableProxy": true
                },
                "insights": {
                    "isEnabled": true,
                    "retentionDays": 30,
                    "logAnalyticsResources": {
                        "workspaces": [],
                        "defaultWorkspaceId": {
                            "id": "[parameters('workspaces_shared_fwpolicy_analytics_workspace_uswest_externalid')]"
                        }
                    }
                },
                "intrusionDetection": {
                    "mode": "Alert",
                    "configuration": {
                        "signatureOverrides": [],
                        "bypassTrafficSettings": []
                    }
                }
            }
        },
        {
            "type": "Microsoft.Network/firewallPolicies/ruleCollectionGroups",
            "apiVersion": "2023-05-01",
            "name": "[concat(parameters('firewallPolicies_avd_fw_policy_uswest_premium_1067c5_name'), '/autodesk')]",
            "location": "West US",
            "dependsOn": [
                "[resourceId('Microsoft.Network/firewallPolicies', parameters('firewallPolicies_avd_fw_policy_uswest_premium_1067c5_name'))]"
            ],
            "properties": {
                "priority": 3000,
                "ruleCollections": [
                    {
                        "ruleCollectionType": "FirewallPolicyFilterRuleCollection",
                        "action": {
                            "type": "Allow"
                        },
                        "rules": [
                            {
                                "ruleType": "ApplicationRule",
                                "name": "login-license-entitlement",
                                "protocols": [
                                    {
                                        "protocolType": "Http",
                                        "port": 80
                                    },
                                    {
                                        "protocolType": "Https",
                                        "port": 443
                                    }
                                ],
                                "fqdnTags": [],
                                "webCategories": [],
                                "targetFqdns": [
                                    "*.autodesk.com",
                                    "*.optimizely.com",
                                    "cdn.jsdelivr.net"
                                ],
                                "targetUrls": [],
                                "terminateTLS": false,
                                "sourceAddresses": [
                                    "10.0.1.0/24"
                                ],
                                "destinationAddresses": [],
                                "sourceIpGroups": [],
                                "httpHeadersToInsert": []
                            },
                            {
                                "ruleType": "ApplicationRule",
                                "name": "content-delivery",
                                "protocols": [
                                    {
                                        "protocolType": "Http",
                                        "port": 80
                                    },
                                    {
                                        "protocolType": "Https",
                                        "port": 443
                                    }
                                ],
                                "fqdnTags": [],
                                "webCategories": [],
                                "targetFqdns": [
                                    "*.web-platform.io"
                                ],
                                "targetUrls": [],
                                "terminateTLS": false,
                                "sourceAddresses": [
                                    "10.0.1.0/24"
                                ],
                                "destinationAddresses": [],
                                "sourceIpGroups": [],
                                "httpHeadersToInsert": []
                            },
                            {
                                "ruleType": "ApplicationRule",
                                "name": "captcha",
                                "protocols": [
                                    {
                                        "protocolType": "Http",
                                        "port": 80
                                    },
                                    {
                                        "protocolType": "Https",
                                        "port": 443
                                    }
                                ],
                                "fqdnTags": [],
                                "webCategories": [],
                                "targetFqdns": [
                                    "*.hcaptcha.com",
                                    "*.msauthimages.net"
                                ],
                                "targetUrls": [],
                                "terminateTLS": false,
                                "sourceAddresses": [
                                    "10.0.1.0/24"
                                ],
                                "destinationAddresses": [],
                                "sourceIpGroups": [],
                                "httpHeadersToInsert": []
                            },
                            {
                                "ruleType": "ApplicationRule",
                                "name": "e-sso",
                                "protocols": [
                                    {
                                        "protocolType": "Http",
                                        "port": 80
                                    },
                                    {
                                        "protocolType": "Https",
                                        "port": 443
                                    }
                                ],
                                "fqdnTags": [],
                                "webCategories": [],
                                "targetFqdns": [
                                    "*.microsoftonline.com",
                                    "*.duosecurity.com",
                                    "*.microsoftazuread-sso.com",
                                    "*.okta.com",
                                    "*.live.net",
                                    "*.msftauth.net"
                                ],
                                "targetUrls": [],
                                "terminateTLS": false,
                                "sourceAddresses": [
                                    "10.0.1.0/24"
                                ],
                                "destinationAddresses": [],
                                "sourceIpGroups": [],
                                "httpHeadersToInsert": []
                            },
                            {
                                "ruleType": "ApplicationRule",
                                "name": "application-monitoring",
                                "protocols": [
                                    {
                                        "protocolType": "Http",
                                        "port": 80
                                    },
                                    {
                                        "protocolType": "Https",
                                        "port": 443
                                    }
                                ],
                                "fqdnTags": [],
                                "webCategories": [],
                                "targetFqdns": [
                                    "*.newrelic.com",
                                    "bam.nr-data.net"
                                ],
                                "targetUrls": [],
                                "terminateTLS": false,
                                "sourceAddresses": [
                                    "10.0.1.0/24"
                                ],
                                "destinationAddresses": [],
                                "sourceIpGroups": [],
                                "httpHeadersToInsert": []
                            },
                            {
                                "ruleType": "ApplicationRule",
                                "name": "microsoft-smartscreen-filter",
                                "protocols": [
                                    {
                                        "protocolType": "Http",
                                        "port": 80
                                    },
                                    {
                                        "protocolType": "Https",
                                        "port": 443
                                    }
                                ],
                                "fqdnTags": [],
                                "webCategories": [],
                                "targetFqdns": [
                                    "urs.microsoft.com"
                                ],
                                "targetUrls": [],
                                "terminateTLS": false,
                                "sourceAddresses": [
                                    "10.0.1.0/24"
                                ],
                                "destinationAddresses": [],
                                "sourceIpGroups": [],
                                "httpHeadersToInsert": []
                            },
                            {
                                "ruleType": "ApplicationRule",
                                "name": "web-analytics",
                                "protocols": [
                                    {
                                        "protocolType": "Http",
                                        "port": 80
                                    },
                                    {
                                        "protocolType": "Https",
                                        "port": 443
                                    }
                                ],
                                "fqdnTags": [],
                                "webCategories": [],
                                "targetFqdns": [
                                    "*.google-analytics.com",
                                    "*.demandbase.com",
                                    "munchkin.marketo.net",
                                    "918-fod-433.mktoresp.com",
                                    "*.demdex.net",
                                    "*.tiqcdn.com",
                                    "*.6sc.co",
                                    "*.googletagmanager.com",
                                    "cm.eversttech.net",
                                    "autodesk.tt.omtrdc.net",
                                    "*.google.com"
                                ],
                                "targetUrls": [],
                                "terminateTLS": false,
                                "sourceAddresses": [
                                    "10.0.1.0/24"
                                ],
                                "destinationAddresses": [],
                                "sourceIpGroups": [],
                                "httpHeadersToInsert": []
                            },
                            {
                                "ruleType": "ApplicationRule",
                                "name": "certificates",
                                "protocols": [
                                    {
                                        "protocolType": "Http",
                                        "port": 80
                                    },
                                    {
                                        "protocolType": "Https",
                                        "port": 443
                                    }
                                ],
                                "fqdnTags": [],
                                "webCategories": [],
                                "targetFqdns": [
                                    "*.ws.symantec.com",
                                    "*.symcd.com",
                                    "*.geotrust.com",
                                    "*.pki.goog",
                                    "*.verisign.com",
                                    "*.ss2.us",
                                    "*.digicert.com",
                                    "*.amazontrust.com",
                                    "crl.microsoft.com"
                                ],
                                "targetUrls": [],
                                "terminateTLS": false,
                                "sourceAddresses": [
                                    "10.0.1.0/24"
                                ],
                                "destinationAddresses": [],
                                "sourceIpGroups": [],
                                "httpHeadersToInsert": []
                            },
                            {
                                "ruleType": "ApplicationRule",
                                "name": "subscription-monitoring",
                                "protocols": [
                                    {
                                        "protocolType": "Http",
                                        "port": 80
                                    },
                                    {
                                        "protocolType": "Https",
                                        "port": 443
                                    }
                                ],
                                "fqdnTags": [],
                                "webCategories": [],
                                "targetFqdns": [
                                    "*.pubnubapi.com"
                                ],
                                "targetUrls": [],
                                "terminateTLS": false,
                                "sourceAddresses": [
                                    "10.0.1.0/24"
                                ],
                                "destinationAddresses": [],
                                "sourceIpGroups": [],
                                "httpHeadersToInsert": []
                            },
                            {
                                "ruleType": "ApplicationRule",
                                "name": "marketing",
                                "protocols": [
                                    {
                                        "protocolType": "Http",
                                        "port": 80
                                    },
                                    {
                                        "protocolType": "Https",
                                        "port": 443
                                    }
                                ],
                                "fqdnTags": [],
                                "webCategories": [],
                                "targetFqdns": [
                                    "*doubleclick.net"
                                ],
                                "targetUrls": [],
                                "terminateTLS": false,
                                "sourceAddresses": [
                                    "10.0.1.0/24"
                                ],
                                "destinationAddresses": [],
                                "sourceIpGroups": [],
                                "httpHeadersToInsert": []
                            },
                            {
                                "ruleType": "ApplicationRule",
                                "name": "in-product-purchase",
                                "protocols": [
                                    {
                                        "protocolType": "Http",
                                        "port": 80
                                    },
                                    {
                                        "protocolType": "Https",
                                        "port": 443
                                    }
                                ],
                                "fqdnTags": [],
                                "webCategories": [],
                                "targetFqdns": [
                                    "gateway.bluesnap.com",
                                    "nexus.ensighten.com",
                                    "d1rvg4h59z7jah.cloudfront.net"
                                ],
                                "targetUrls": [],
                                "terminateTLS": false,
                                "sourceAddresses": [
                                    "10.0.1.0/24"
                                ],
                                "destinationAddresses": [],
                                "sourceIpGroups": [],
                                "httpHeadersToInsert": []
                            },
                            {
                                "ruleType": "ApplicationRule",
                                "name": "recap-sign-in",
                                "protocols": [
                                    {
                                        "protocolType": "Http",
                                        "port": 80
                                    },
                                    {
                                        "protocolType": "Https",
                                        "port": 443
                                    }
                                ],
                                "fqdnTags": [],
                                "webCategories": [],
                                "targetFqdns": [
                                    "*.akamaiedge.net"
                                ],
                                "targetUrls": [],
                                "terminateTLS": false,
                                "sourceAddresses": [
                                    "10.0.1.0/24"
                                ],
                                "destinationAddresses": [],
                                "sourceIpGroups": [],
                                "httpHeadersToInsert": []
                            },
                            {
                                "ruleType": "ApplicationRule",
                                "name": "ad-sso",
                                "protocols": [
                                    {
                                        "protocolType": "Http",
                                        "port": 80
                                    },
                                    {
                                        "protocolType": "Https",
                                        "port": 443
                                    }
                                ],
                                "fqdnTags": [],
                                "webCategories": [],
                                "targetFqdns": [
                                    "*.amazonaws.com"
                                ],
                                "targetUrls": [],
                                "terminateTLS": false,
                                "sourceAddresses": [
                                    "10.0.1.0/24"
                                ],
                                "destinationAddresses": [],
                                "sourceIpGroups": [],
                                "httpHeadersToInsert": []
                            },
                            {
                                "ruleType": "ApplicationRule",
                                "name": "misc",
                                "protocols": [
                                    {
                                        "protocolType": "Http",
                                        "port": 80
                                    },
                                    {
                                        "protocolType": "Https",
                                        "port": 443
                                    }
                                ],
                                "fqdnTags": [],
                                "webCategories": [],
                                "targetFqdns": [
                                    "*.nr-data.net",
                                    "*.6sense.com",
                                    "*.segment.io",
                                    "*.everesttech.net",
                                    "*.adnxs.com",
                                    "*.oktacdn.com"
                                ],
                                "targetUrls": [],
                                "terminateTLS": false,
                                "sourceAddresses": [
                                    "10.0.1.0/24"
                                ],
                                "destinationAddresses": [],
                                "sourceIpGroups": [],
                                "httpHeadersToInsert": []
                            },
                            {
                                "ruleType": "ApplicationRule",
                                "name": "doc-management",
                                "protocols": [
                                    {
                                        "protocolType": "Http",
                                        "port": 80
                                    },
                                    {
                                        "protocolType": "Https",
                                        "port": 443
                                    }
                                ],
                                "fqdnTags": [],
                                "webCategories": [],
                                "targetFqdns": [
                                    "*.cloudfront.net",
                                    "*.autocadws.com",
                                    "*.evergage.com",
                                    "*ravenjs.com",
                                    "*.cloudflare.com",
                                    "*.sentry.io",
                                    "*.sendgrid.net"
                                ],
                                "targetUrls": [],
                                "terminateTLS": false,
                                "sourceAddresses": [
                                    "10.0.1.0/24"
                                ],
                                "destinationAddresses": [],
                                "sourceIpGroups": [],
                                "httpHeadersToInsert": []
                            }
                        ],
                        "name": "application-rules-autodesk",
                        "priority": 3001
                    }
                ]
            }
        },
        {
            "type": "Microsoft.Network/firewallPolicies/ruleCollectionGroups",
            "apiVersion": "2023-05-01",
            "name": "[concat(parameters('firewallPolicies_avd_fw_policy_uswest_premium_1067c5_name'), '/avd-optional')]",
            "location": "West US",
            "dependsOn": [
                "[resourceId('Microsoft.Network/firewallPolicies', parameters('firewallPolicies_avd_fw_policy_uswest_premium_1067c5_name'))]"
            ],
            "properties": {
                "priority": 2000,
                "ruleCollections": [
                    {
                        "ruleCollectionType": "FirewallPolicyFilterRuleCollection",
                        "action": {
                            "type": "Allow"
                        },
                        "rules": [
                            {
                                "ruleType": "NetworkRule",
                                "name": "ssl-fqdns",
                                "ipProtocols": [
                                    "TCP"
                                ],
                                "sourceAddresses": [
                                    "10.0.1.128/25"
                                ],
                                "sourceIpGroups": [],
                                "destinationAddresses": [],
                                "destinationIpGroups": [],
                                "destinationFqdns": [
                                    "login.windows.net",
                                    "www.msftconnecttest.com"
                                ],
                                "destinationPorts": [
                                    "443"
                                ]
                            },
                            {
                                "ruleType": "NetworkRule",
                                "name": "ntp-fqdns",
                                "ipProtocols": [
                                    "UDP"
                                ],
                                "sourceAddresses": [
                                    "10.0.1.128/25"
                                ],
                                "sourceIpGroups": [],
                                "destinationAddresses": [],
                                "destinationIpGroups": [],
                                "destinationFqdns": [
                                    "time.windows.com"
                                ],
                                "destinationPorts": [
                                    "123"
                                ]
                            }
                        ],
                        "name": "networkrules-avd-optional",
                        "priority": 2001
                    },
                    {
                        "ruleCollectionType": "FirewallPolicyFilterRuleCollection",
                        "action": {
                            "type": "Allow"
                        },
                        "rules": [
                            {
                                "ruleType": "ApplicationRule",
                                "name": "fqdn-tags",
                                "protocols": [
                                    {
                                        "protocolType": "Https",
                                        "port": 443
                                    }
                                ],
                                "fqdnTags": [
                                    "WindowsDiagnostics",
                                    "WindowsUpdate",
                                    "MicrosoftActiveProtectionService"
                                ],
                                "webCategories": [],
                                "targetFqdns": [],
                                "targetUrls": [],
                                "terminateTLS": false,
                                "sourceAddresses": [
                                    "10.0.1.128/25"
                                ],
                                "destinationAddresses": [],
                                "sourceIpGroups": [],
                                "httpHeadersToInsert": []
                            },
                            {
                                "ruleType": "ApplicationRule",
                                "name": "fqdns",
                                "protocols": [
                                    {
                                        "protocolType": "Https",
                                        "port": 443
                                    }
                                ],
                                "fqdnTags": [],
                                "webCategories": [],
                                "targetFqdns": [
                                    "*.events.data.microsoft.com",
                                    "*.sfx.ms",
                                    "*.digicert.com",
                                    "*.azure-dns.com",
                                    "*.azure-dns.net"
                                ],
                                "targetUrls": [],
                                "terminateTLS": false,
                                "sourceAddresses": [
                                    "10.0.1.128/25"
                                ],
                                "destinationAddresses": [],
                                "sourceIpGroups": [],
                                "httpHeadersToInsert": []
                            }
                        ],
                        "name": "applicationrules-avd-optional",
                        "priority": 2002
                    }
                ]
            }
        },
        {
            "type": "Microsoft.Network/firewallPolicies/ruleCollectionGroups",
            "apiVersion": "2023-05-01",
            "name": "[concat(parameters('firewallPolicies_avd_fw_policy_uswest_premium_1067c5_name'), '/avd-required')]",
            "location": "West US",
            "dependsOn": [
                "[resourceId('Microsoft.Network/firewallPolicies', parameters('firewallPolicies_avd_fw_policy_uswest_premium_1067c5_name'))]"
            ],
            "properties": {
                "priority": 1000,
                "ruleCollections": [
                    {
                        "ruleCollectionType": "FirewallPolicyFilterRuleCollection",
                        "action": {
                            "type": "Allow"
                        },
                        "rules": [
                            {
                                "ruleType": "NetworkRule",
                                "name": "ssl-fqdns",
                                "ipProtocols": [
                                    "TCP"
                                ],
                                "sourceAddresses": [
                                    "10.0.1.128/25"
                                ],
                                "sourceIpGroups": [],
                                "destinationAddresses": [],
                                "destinationIpGroups": [],
                                "destinationFqdns": [
                                    "login.microsoftonline.com"
                                ],
                                "destinationPorts": [
                                    "443"
                                ]
                            },
                            {
                                "ruleType": "NetworkRule",
                                "name": "service-tags",
                                "ipProtocols": [
                                    "TCP"
                                ],
                                "sourceAddresses": [
                                    "10.0.1.128/25"
                                ],
                                "sourceIpGroups": [],
                                "destinationAddresses": [
                                    "WindowsVirtualDesktop",
                                    "AzureCloud",
                                    "AzureFrontDoor.Frontend",
                                    "AzureMonitor",
                                    "AzureActiveDirectory",
                                    "AzureTrafficManager"
                                ],
                                "destinationIpGroups": [],
                                "destinationFqdns": [],
                                "destinationPorts": [
                                    "443"
                                ]
                            },
                            {
                                "ruleType": "NetworkRule",
                                "name": "ip-addresses",
                                "ipProtocols": [
                                    "TCP"
                                ],
                                "sourceAddresses": [
                                    "10.0.1.128/25"
                                ],
                                "sourceIpGroups": [],
                                "destinationAddresses": [
                                    "169.254.169.254"
                                ],
                                "destinationIpGroups": [],
                                "destinationFqdns": [],
                                "destinationPorts": [
                                    "80"
                                ]
                            },
                            {
                                "ruleType": "NetworkRule",
                                "name": "http-fqdns",
                                "ipProtocols": [
                                    "TCP"
                                ],
                                "sourceAddresses": [
                                    "10.0.1.128/25"
                                ],
                                "sourceIpGroups": [],
                                "destinationAddresses": [],
                                "destinationIpGroups": [],
                                "destinationFqdns": [
                                    "oneocsp.microsoft.com",
                                    "www.microsoft.com"
                                ],
                                "destinationPorts": [
                                    "80"
                                ]
                            },
                            {
                                "ruleType": "NetworkRule",
                                "name": "kms-fqdns",
                                "ipProtocols": [
                                    "TCP"
                                ],
                                "sourceAddresses": [
                                    "10.0.1.128/25"
                                ],
                                "sourceIpGroups": [],
                                "destinationAddresses": [],
                                "destinationIpGroups": [],
                                "destinationFqdns": [
                                    "kms.core.windows.ne",
                                    "azkms.core.windows.ne"
                                ],
                                "destinationPorts": [
                                    "1688"
                                ]
                            },
                            {
                                "ruleType": "NetworkRule",
                                "name": "dns-all",
                                "ipProtocols": [
                                    "TCP",
                                    "UDP"
                                ],
                                "sourceAddresses": [
                                    "10.0.1.128/25"
                                ],
                                "sourceIpGroups": [],
                                "destinationAddresses": [
                                    "*"
                                ],
                                "destinationIpGroups": [],
                                "destinationFqdns": [],
                                "destinationPorts": [
                                    "53"
                                ]
                            },
                            {
                                "ruleType": "NetworkRule",
                                "name": "kms-ips",
                                "ipProtocols": [
                                    "TCP"
                                ],
                                "sourceAddresses": [
                                    "10.0.1.0/24"
                                ],
                                "sourceIpGroups": [],
                                "destinationAddresses": [
                                    "20.118.99.224",
                                    "40.83.235.53"
                                ],
                                "destinationIpGroups": [],
                                "destinationFqdns": [],
                                "destinationPorts": [
                                    "1688"
                                ]
                            }
                        ],
                        "name": "networkrules-avd-required",
                        "priority": 1001
                    }
                ]
            }
        },
        {
            "type": "Microsoft.Network/firewallPolicies/ruleCollectionGroups",
            "apiVersion": "2023-05-01",
            "name": "[concat(parameters('firewallPolicies_avd_fw_policy_uswest_premium_1067c5_name'), '/egnyte-storage-sync')]",
            "location": "West US",
            "dependsOn": [
                "[resourceId('Microsoft.Network/firewallPolicies', parameters('firewallPolicies_avd_fw_policy_uswest_premium_1067c5_name'))]"
            ],
            "properties": {
                "priority": 4000,
                "ruleCollections": [
                    {
                        "ruleCollectionType": "FirewallPolicyFilterRuleCollection",
                        "action": {
                            "type": "Allow"
                        },
                        "rules": [
                            {
                                "ruleType": "NetworkRule",
                                "name": "allow-all-in",
                                "ipProtocols": [
                                    "Any"
                                ],
                                "sourceAddresses": [
                                    "*"
                                ],
                                "sourceIpGroups": [],
                                "destinationAddresses": [
                                    "*"
                                ],
                                "destinationIpGroups": [],
                                "destinationFqdns": [],
                                "destinationPorts": [
                                    "*"
                                ]
                            }
                        ],
                        "name": "networkrules-egnyte",
                        "priority": 4001
                    },
                    {
                        "ruleCollectionType": "FirewallPolicyFilterRuleCollection",
                        "action": {
                            "type": "Allow"
                        },
                        "rules": [
                            {
                                "ruleType": "ApplicationRule",
                                "name": "egnyte",
                                "protocols": [
                                    {
                                        "protocolType": "Http",
                                        "port": 80
                                    },
                                    {
                                        "protocolType": "Https",
                                        "port": 443
                                    }
                                ],
                                "fqdnTags": [],
                                "webCategories": [],
                                "targetFqdns": [
                                    "*.egnyte.com",
                                    "*.egnyte-internal.com",
                                    "*.egnyte-appliance.com"
                                ],
                                "targetUrls": [],
                                "terminateTLS": false,
                                "sourceAddresses": [
                                    "10.0.0.128/26",
                                    "10.0.1.0/24"
                                ],
                                "destinationAddresses": [],
                                "sourceIpGroups": [],
                                "httpHeadersToInsert": []
                            },
                            {
                                "ruleType": "ApplicationRule",
                                "name": "misc",
                                "protocols": [
                                    {
                                        "protocolType": "Http",
                                        "port": 80
                                    },
                                    {
                                        "protocolType": "Https",
                                        "port": 443
                                    }
                                ],
                                "fqdnTags": [],
                                "webCategories": [],
                                "targetFqdns": [
                                    "*.googleusercontent.com",
                                    "*.gcr.io",
                                    "*.googleapis.com"
                                ],
                                "targetUrls": [],
                                "terminateTLS": false,
                                "sourceAddresses": [
                                    "10.0.0.128/26",
                                    "10.0.1.0/24"
                                ],
                                "destinationAddresses": [],
                                "sourceIpGroups": [],
                                "httpHeadersToInsert": []
                            }
                        ],
                        "name": "applicationrules-egnyte",
                        "priority": 4002
                    }
                ]
            }
        },
        {
            "type": "Microsoft.Network/firewallPolicies/ruleCollectionGroups",
            "apiVersion": "2023-05-01",
            "name": "[concat(parameters('firewallPolicies_avd_fw_policy_uswest_premium_1067c5_name'), '/internal-vnet')]",
            "location": "West US",
            "dependsOn": [
                "[resourceId('Microsoft.Network/firewallPolicies', parameters('firewallPolicies_avd_fw_policy_uswest_premium_1067c5_name'))]"
            ],
            "properties": {
                "priority": 300,
                "ruleCollections": [
                    {
                        "ruleCollectionType": "FirewallPolicyNatRuleCollection",
                        "action": {
                            "type": "Dnat"
                        },
                        "rules": [
                            {
                                "ruleType": "NatRule",
                                "name": "admin-vm1-dnat",
                                "translatedAddress": "10.0.1.4",
                                "translatedPort": "3389",
                                "ipProtocols": [
                                    "TCP"
                                ],
                                "sourceAddresses": [
                                    "*"
                                ],
                                "sourceIpGroups": [],
                                "destinationAddresses": [
                                    "20.253.198.8"
                                ],
                                "destinationPorts": [
                                    "3389"
                                ]
                            },
                            {
                                "ruleType": "NatRule",
                                "name": "admin-vm2-dnat",
                                "translatedAddress": "10.0.1.6",
                                "translatedPort": "3389",
                                "ipProtocols": [
                                    "TCP"
                                ],
                                "sourceAddresses": [
                                    "*"
                                ],
                                "sourceIpGroups": [],
                                "destinationAddresses": [
                                    "20.253.198.8"
                                ],
                                "destinationPorts": [
                                    "3390"
                                ]
                            }
                        ],
                        "name": "dnatrules-internal-vnet",
                        "priority": 301
                    },
                    {
                        "ruleCollectionType": "FirewallPolicyFilterRuleCollection",
                        "action": {
                            "type": "Allow"
                        },
                        "rules": [
                            {
                                "ruleType": "NetworkRule",
                                "name": "allow-internal",
                                "ipProtocols": [
                                    "Any"
                                ],
                                "sourceAddresses": [
                                    "10.0.0.128/26",
                                    "10.0.1.0/24"
                                ],
                                "sourceIpGroups": [],
                                "destinationAddresses": [
                                    "10.0.0.128/26",
                                    "10.0.1.0/24"
                                ],
                                "destinationIpGroups": [],
                                "destinationFqdns": [],
                                "destinationPorts": [
                                    "*"
                                ]
                            }
                        ],
                        "name": "networkrules-internal-vnet",
                        "priority": 302
                    }
                ]
            }
        },
        {
            "type": "Microsoft.Network/firewallPolicies/ruleCollectionGroups",
            "apiVersion": "2023-05-01",
            "name": "[concat(parameters('firewallPolicies_avd_fw_policy_uswest_premium_1067c5_name'), '/internet')]",
            "location": "West US",
            "dependsOn": [
                "[resourceId('Microsoft.Network/firewallPolicies', parameters('firewallPolicies_avd_fw_policy_uswest_premium_1067c5_name'))]"
            ],
            "properties": {
                "priority": 20000,
                "ruleCollections": [
                    {
                        "ruleCollectionType": "FirewallPolicyFilterRuleCollection",
                        "action": {
                            "type": "Allow"
                        },
                        "rules": [
                            {
                                "ruleType": "ApplicationRule",
                                "name": "general-browsing",
                                "protocols": [
                                    {
                                        "protocolType": "Http",
                                        "port": 80
                                    },
                                    {
                                        "protocolType": "Https",
                                        "port": 443
                                    }
                                ],
                                "fqdnTags": [],
                                "webCategories": [
                                    "business",
                                    "computersandtechnology",
                                    "education",
                                    "finance",
                                    "forumsandnewsgroups",
                                    "government",
                                    "healthandmedicine",
                                    "informationsecurity",
                                    "jobsearch",
                                    "news",
                                    "nonprofitsandngos",
                                    "personalsites",
                                    "professionalnetworking",
                                    "searchenginesandportals",
                                    "translators",
                                    "webrepositoryandstorage",
                                    "webbasedemail",
                                    "advertisementsandpopups",
                                    "chat",
                                    "games",
                                    "instantmessaging",
                                    "shopping",
                                    "socialnetworking",
                                    "arts",
                                    "fashionandbeauty",
                                    "general",
                                    "leisureandrecreation",
                                    "natureandconservation",
                                    "politicsandlaw",
                                    "realestate",
                                    "religion",
                                    "restaurantsanddining",
                                    "sports",
                                    "transportation",
                                    "travel"
                                ],
                                "targetFqdns": [],
                                "targetUrls": [],
                                "terminateTLS": false,
                                "sourceAddresses": [
                                    "10.0.1.0/24"
                                ],
                                "destinationAddresses": [],
                                "sourceIpGroups": [],
                                "httpHeadersToInsert": []
                            }
                        ],
                        "name": "applicationrules-internet",
                        "priority": 20002
                    },
                    {
                        "ruleCollectionType": "FirewallPolicyFilterRuleCollection",
                        "action": {
                            "type": "Deny"
                        },
                        "rules": [
                            {
                                "ruleType": "ApplicationRule",
                                "name": "deny-web-categories",
                                "protocols": [
                                    {
                                        "protocolType": "Http",
                                        "port": 80
                                    },
                                    {
                                        "protocolType": "Https",
                                        "port": 443
                                    }
                                ],
                                "fqdnTags": [],
                                "webCategories": [
                                    "childabuseimages",
                                    "criminalactivity",
                                    "datingandpersonals",
                                    "gambling",
                                    "hacking",
                                    "hateandintolerance",
                                    "illegaldrug",
                                    "illegalsoftware",
                                    "lingerieandswimsuits",
                                    "marijuana",
                                    "nudity",
                                    "pornographyandsexuallyexplicit",
                                    "selfharm",
                                    "sexeducation",
                                    "tasteless",
                                    "violence",
                                    "weapons",
                                    "imagesharing",
                                    "peertopeer",
                                    "streamingmediaanddownloads",
                                    "downloadsites",
                                    "entertainment",
                                    "cults"
                                ],
                                "targetFqdns": [],
                                "targetUrls": [],
                                "terminateTLS": false,
                                "sourceAddresses": [
                                    "10.0.1.0/24"
                                ],
                                "destinationAddresses": [],
                                "sourceIpGroups": [],
                                "httpHeadersToInsert": []
                            }
                        ],
                        "name": "applicationrules-internet-deny",
                        "priority": 20001
                    }
                ]
            }
        },
        {
            "type": "Microsoft.Network/firewallPolicies/ruleCollectionGroups",
            "apiVersion": "2023-05-01",
            "name": "[concat(parameters('firewallPolicies_avd_fw_policy_uswest_premium_1067c5_name'), '/windows-365-base')]",
            "location": "West US",
            "dependsOn": [
                "[resourceId('Microsoft.Network/firewallPolicies', parameters('firewallPolicies_avd_fw_policy_uswest_premium_1067c5_name'))]"
            ],
            "properties": {
                "priority": 5000,
                "ruleCollections": [
                    {
                        "ruleCollectionType": "FirewallPolicyFilterRuleCollection",
                        "action": {
                            "type": "Allow"
                        },
                        "rules": [
                            {
                                "ruleType": "NetworkRule",
                                "name": "devices-provisioning-rule",
                                "ipProtocols": [
                                    "TCP"
                                ],
                                "sourceAddresses": [
                                    "10.0.1.0/24"
                                ],
                                "sourceIpGroups": [],
                                "destinationAddresses": [],
                                "destinationIpGroups": [],
                                "destinationFqdns": [
                                    "global.azure-devices-provisioning.net"
                                ],
                                "destinationPorts": [
                                    "443",
                                    "5671"
                                ]
                            },
                            {
                                "ruleType": "NetworkRule",
                                "name": "iot-preu-registration-rule",
                                "ipProtocols": [
                                    "TCP"
                                ],
                                "sourceAddresses": [
                                    "10.0.1.0/24"
                                ],
                                "sourceIpGroups": [],
                                "destinationAddresses": [],
                                "destinationIpGroups": [],
                                "destinationFqdns": [
                                    "hm-iot-in-prod-preu01.azure-devices.net"
                                ],
                                "destinationPorts": [
                                    "443",
                                    "5671"
                                ]
                            },
                            {
                                "ruleType": "NetworkRule",
                                "name": "iot-prap-registration-rule",
                                "ipProtocols": [
                                    "TCP"
                                ],
                                "sourceAddresses": [
                                    "10.0.1.0/24"
                                ],
                                "sourceIpGroups": [],
                                "destinationAddresses": [],
                                "destinationIpGroups": [],
                                "destinationFqdns": [
                                    "hm-iot-in-prod-prap01.azure-devices.net"
                                ],
                                "destinationPorts": [
                                    "443",
                                    "5671"
                                ]
                            },
                            {
                                "ruleType": "NetworkRule",
                                "name": "iot-prna-registration-rule",
                                "ipProtocols": [
                                    "TCP"
                                ],
                                "sourceAddresses": [
                                    "10.0.1.0/24"
                                ],
                                "sourceIpGroups": [],
                                "destinationAddresses": [],
                                "destinationIpGroups": [],
                                "destinationFqdns": [
                                    "hm-iot-in-prod-prna01.azure-devices.net"
                                ],
                                "destinationPorts": [
                                    "443",
                                    "5671"
                                ]
                            },
                            {
                                "ruleType": "NetworkRule",
                                "name": "iot-prau-registration-rule",
                                "ipProtocols": [
                                    "TCP"
                                ],
                                "sourceAddresses": [
                                    "10.0.1.0/24"
                                ],
                                "sourceIpGroups": [],
                                "destinationAddresses": [],
                                "destinationIpGroups": [],
                                "destinationFqdns": [
                                    "hm-iot-in-prod-prau01.azure-devices.net"
                                ],
                                "destinationPorts": [
                                    "443",
                                    "5671"
                                ]
                            },
                            {
                                "ruleType": "NetworkRule",
                                "name": "udp-turn-connectivity-rule",
                                "ipProtocols": [
                                    "UDP"
                                ],
                                "sourceAddresses": [
                                    "10.0.1.0/24"
                                ],
                                "sourceIpGroups": [],
                                "destinationAddresses": [
                                    "20.202.0.0/16"
                                ],
                                "destinationIpGroups": [],
                                "destinationFqdns": [],
                                "destinationPorts": [
                                    "3478"
                                ]
                            },
                            {
                                "ruleType": "NetworkRule",
                                "name": "turn-conectivity-rule",
                                "ipProtocols": [
                                    "TCP"
                                ],
                                "sourceAddresses": [
                                    "10.0.1.0/24"
                                ],
                                "sourceIpGroups": [],
                                "destinationAddresses": [
                                    "20.202.0.0/16"
                                ],
                                "destinationIpGroups": [],
                                "destinationFqdns": [],
                                "destinationPorts": [
                                    "443"
                                ]
                            }
                        ],
                        "name": "networkrules-windows365-base",
                        "priority": 5001
                    },
                    {
                        "ruleCollectionType": "FirewallPolicyFilterRuleCollection",
                        "action": {
                            "type": "Allow"
                        },
                        "rules": [
                            {
                                "ruleType": "ApplicationRule",
                                "name": "windows-365-rule",
                                "protocols": [
                                    {
                                        "protocolType": "Http",
                                        "port": 80
                                    },
                                    {
                                        "protocolType": "Https",
                                        "port": 443
                                    }
                                ],
                                "fqdnTags": [
                                    "Windows365"
                                ],
                                "webCategories": [],
                                "targetFqdns": [],
                                "targetUrls": [],
                                "terminateTLS": false,
                                "sourceAddresses": [
                                    "10.0.1.0/24"
                                ],
                                "destinationAddresses": [],
                                "sourceIpGroups": [],
                                "httpHeadersToInsert": []
                            },
                            {
                                "ruleType": "ApplicationRule",
                                "name": "intune-rule",
                                "protocols": [
                                    {
                                        "protocolType": "Http",
                                        "port": 80
                                    },
                                    {
                                        "protocolType": "Https",
                                        "port": 443
                                    }
                                ],
                                "fqdnTags": [
                                    "MicrosoftIntune"
                                ],
                                "webCategories": [],
                                "targetFqdns": [],
                                "targetUrls": [],
                                "terminateTLS": false,
                                "sourceAddresses": [
                                    "10.0.1.0/24"
                                ],
                                "destinationAddresses": [],
                                "sourceIpGroups": [],
                                "httpHeadersToInsert": []
                            },
                            {
                                "ruleType": "ApplicationRule",
                                "name": "office-365-rule",
                                "protocols": [
                                    {
                                        "protocolType": "Http",
                                        "port": 80
                                    },
                                    {
                                        "protocolType": "Https",
                                        "port": 443
                                    }
                                ],
                                "fqdnTags": [
                                    "Office365.Exchange.Optimize",
                                    "Office365.Exchange.Default.Required",
                                    "Office365.Exchange.Allow.Required",
                                    "Office365.Skype.Allow.Required",
                                    "Office365.Skype.Default.Required",
                                    "Office365.Skype.Default.NotRequired",
                                    "Office365.Skype.Allow.NotRequired",
                                    "Office365.SharePoint.Optimize",
                                    "Office365.SharePoint.Default.NotRequired",
                                    "Office365.SharePoint.Default.Required",
                                    "Office365.Common.Default.NotRequired",
                                    "Office365.Common.Allow.Required",
                                    "Office365.Common.Default.Required"
                                ],
                                "webCategories": [],
                                "targetFqdns": [],
                                "targetUrls": [],
                                "terminateTLS": false,
                                "sourceAddresses": [
                                    "10.0.1.0/24"
                                ],
                                "destinationAddresses": [],
                                "sourceIpGroups": [],
                                "httpHeadersToInsert": []
                            },
                            {
                                "ruleType": "ApplicationRule",
                                "name": "windows-update-rule",
                                "protocols": [
                                    {
                                        "protocolType": "Http",
                                        "port": 80
                                    },
                                    {
                                        "protocolType": "Https",
                                        "port": 443
                                    }
                                ],
                                "fqdnTags": [
                                    "WindowsUpdate"
                                ],
                                "webCategories": [],
                                "targetFqdns": [],
                                "targetUrls": [],
                                "terminateTLS": false,
                                "sourceAddresses": [
                                    "10.0.1.0/24"
                                ],
                                "destinationAddresses": [],
                                "sourceIpGroups": [],
                                "httpHeadersToInsert": []
                            }
                        ],
                        "name": "applicationrules-windows-365-base",
                        "priority": 5002
                    }
                ]
            }
        }
    ]
}